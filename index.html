
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>¬øMereces el videojuego?</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<canvas id="confetti" class="confetti-canvas"></canvas>
<div class="container">
  <div class="header">
    <div class="title">¬øMereces el videojuego?</div>
    <div class="progress" id="progress"></div>
  </div>

  <!-- INTRO -->
  <section class="intro show" id="intro">
    <div class="badge">Bienvenido</div>
    <h2 class="question-text" style="margin-top:12px;">
      FELIZ CUMPLEA√ëOS VALENTE!!<br>
      Que bueno que encontraste la segunda parte del regalo.<br>
      Ah√≠ te va el reto üéÅ
    </h2>
    <div class="controls">
      <button id="startBtn" class="primary">Comenzar</button>
    </div>
    <p class="small">Responde correctamente cada pregunta para avanzar. Si fallas demasiadas veces‚Ä¶ <b>el portal se cierra 30 min</b> üòà</p>
  </section>

  <!-- LOCK -->
  <section class="lock" id="lock">
    <h2>üòÖ Has fallado demasiadas veces.</h2>
    <div> <b>No se vale hacer trampa!</b> </div>
    <div class="timer" id="lockTimer">00:00</div>
    <div class="note">Vuelve cuando el contador llegue a cero.</div>
    <div class="controls" style="margin-top:16px;">
      <button id="checkAgain" class="secondary">Revisar de nuevo</button>
    </div>
  </section>

  <!-- QUESTION -->
  <section class="question" id="quiz">
    <div id="qTextWrap">
      <h2 id="qText" class="question-text"></h2>
    </div>
    <div class="options" id="options"></div>
    <div class="feedback" id="feedback"></div>
    <div class="controls">
      <button id="nextBtn" class="primary" disabled>Siguiente ‚ûú</button>
      <button id="retryBtn" class="secondary hidden">Intentar de nuevo</button>
    </div>
  </section>

  <!-- FINAL -->
  <section class="final" id="final">
    <h2>üéâ ¬°Felicidades!</h2>
    <div class="prize">¬°Felicidades! Ganaste el acceso al videojuego, el c√≥digo es <b>XYZ123</b></div>
    <p class="small">Puedes cerrar esta ventana y entregar el c√≥digo.</p>
  </section>
</div>

<script>
// ====== Config ======
const QUESTIONS = [{"q": "Seg√∫n Schur, ¬øcu√°les son las cuatro preguntas que resumen la filosof√≠a moral?", "a": ["¬øQu√© es bueno? ¬øQui√©n soy? ¬øD√≥nde estoy? ¬øCu√°ndo act√∫o?", "¬øQu√© estamos haciendo? ¬øPor qu√© lo hacemos? ¬øHay algo mejor que podamos hacer? ¬øPor qu√© es mejor?", "¬øQu√© har√≠a Arist√≥teles?", "¬øQui√©n tiene la culpa?"], "c": 1}, {"q": "¬øQu√© muestra el ejemplo del ‚Äúd√≠a perfecto‚Äù al inicio del libro?", "a": ["Que con buenas intenciones siempre se logra hacer el bien", "Que incluso las buenas intenciones pueden tener consecuencias negativas", "Que solo los millonarios pueden ser √©ticos", "Que la vaca feliz es un mito urbano"], "c": 1}, {"q": "¬øQu√© simboliza la ‚ÄúGoodness Accountant‚Äù?", "a": ["Un √°ngel guardi√°n", "Una figura imaginaria que mide lo bueno o malo de nuestras acciones", "Un personaje real de The Good Place", "Un programa de contabilidad"], "c": 1}, {"q": "¬øPor qu√© Schur prefiere traducir eudaimonia como ‚Äúflourishing‚Äù y no ‚Äúhappiness‚Äù?", "a": ["Porque ‚Äúflourishing‚Äù implica plenitud y desarrollo, no solo placer", "Porque la palabra ‚Äúhappiness‚Äù es demasiado antigua", "Porque Arist√≥teles odiaba la palabra felicidad", "Porque suena m√°s elegante"], "c": 0}, {"q": "Seg√∫n Arist√≥teles, ¬øc√≥mo se adquieren las virtudes humanas?", "a": ["Nacemos con ellas", "Las recibimos de los dioses", "Se aprenden por h√°bito y pr√°ctica constante", "Se compran en Amazon"], "c": 2}, {"q": "¬øQu√© representa el ‚ÄúGolden Mean‚Äù?", "a": ["El punto medio entre el exceso y la carencia de una virtud", "La l√≠nea de metro dorada de Atenas", "Un ideal religioso", "El promedio de felicidad mundial"], "c": 0}, {"q": "En el ejemplo de la ira, ¬øqu√© es el exceso y la falta de esta virtud?", "a": ["Demasiado enojo = violencia; muy poco = apat√≠a o cobard√≠a", "Demasiado enojo = liderazgo; poco enojo = sabidur√≠a", "Enfado siempre es malo", "Ninguna de las anteriores"], "c": 0}, {"q": "¬øPor qu√© Schur compara la virtud con tocar la gaita?", "a": ["Porque ambas requieren pr√°ctica constante para dominarse", "Porque Arist√≥teles amaba la m√∫sica", "Porque su amigo Rob toca gaita", "Porque el sonido es insoportable, como la √©tica"], "c": 0}, {"q": "¬øQu√© considera Judith Shklar el peor vicio?", "a": ["La soberbia", "La pereza", "La crueldad", "La envidia"], "c": 2}, {"q": "¬øQu√© dilema √©tico ilustra el ‚ÄúTrolley Problem‚Äù?", "a": ["Elegir entre causar da√±o directo o permitir un da√±o mayor", "Decidir qui√©n maneja el tren", "Demostrar que todos somos ego√≠stas", "Un problema t√©cnico de transporte"], "c": 0}, {"q": "¬øPor qu√© Schur usa humor o ejemplos absurdos?", "a": ["Para mostrar que la √©tica cotidiana puede ser tan rid√≠cula como compleja", "Para burlarse de los fil√≥sofos", "Para atraer lectores adolescentes", "Para llenar p√°ginas"], "c": 0}, {"q": "¬øQu√© aprendi√≥ Schur al crear The Good Place?", "a": ["Que casi todo lo que hacemos tiene un componente √©tico", "Que la gente prefiere los villanos", "Que la moral no sirve para televisi√≥n", "Que los fil√≥sofos son buenos actores"], "c": 0}, {"q": "¬øQu√© diferencia menciona entre ‚Äúmorals‚Äù y ‚Äúethics‚Äù?", "a": ["Que son distintas, pero √©l decide usarlas igual porque la vida es corta", "Que los ‚Äúmorals‚Äù son de ricos", "Que solo los ling√ºistas saben la diferencia", "Que uno es americano y otro brit√°nico"], "c": 0}, {"q": "¬øCu√°l es la principal cr√≠tica al concepto del ‚Äúmean‚Äù de Arist√≥teles?", "a": ["Que es dif√≠cil saber cu√°l es el punto medio exacto en cada caso", "Que solo aplica a fil√≥sofos", "Que fue inventado en Alemania", "Que contradice la f√≠sica"], "c": 0}, {"q": "¬øQu√© rol cumple el fracaso en el proceso moral, seg√∫n Schur?", "a": ["Es inevitable y √∫til para aprender a ser mejores", "Se debe evitar a toda costa", "Es una se√±al de debilidad", "No tiene relaci√≥n con la √©tica"], "c": 0}, {"q": "¬øQui√©n es ‚Äústupid Wendy‚Äù?", "a": ["Una amiga ficticia que da malos consejos", "Una fil√≥sofa real", "Una vaca triste", "Una compa√±era de The Good Place"], "c": 0}, {"q": "¬øQu√© opina Schur sobre el ‚Äúrunner‚Äôs high‚Äù?", "a": ["Que es una experiencia espiritual", "Que es mentira, correr es horrible", "Que Arist√≥teles lo invent√≥", "Que representa la virtud del esfuerzo"], "c": 1}, {"q": "¬øQu√© virtud personal exagera Schur en su an√©cdota del volumen en fiestas?", "a": ["Valent√≠a", "Dutifulness (obediencia a las reglas)", "Generosidad", "Templanza"], "c": 1}, {"q": "Seg√∫n Schur, ¬øqu√© ser√≠a una virtud de un cuchillo?", "a": ["Ser filoso y balanceado", "No cortar a nadie", "Servir para untar mantequilla", "Estar limpio"], "c": 0}, {"q": "¬øQu√© broma hace sobre los fil√≥sofos alemanes?", "a": ["Que se preguntan ‚Äúpor qu√© hay cosas‚Äù", "Que todos son fascistas", "Que solo hablan de cocina", "Que nadie los entiende"], "c": 0}, {"q": "(Footnote) ¬øQu√© tipo de personas dice que no se preocupan por la √©tica?", "a": ["Tramposos, mentirosos y ‚ÄúWolf of Wall Street maniacs‚Äù", "Monjes", "Ni√±os peque√±os", "Profesores"], "c": 0}, {"q": "(Footnote) ¬øPor qu√© decide ignorar la diferencia entre ‚Äúmorals‚Äù y ‚Äúethics‚Äù?", "a": ["Porque no vale la pena discutirlo", "Porque son sin√≥nimos cient√≠ficos", "Porque Arist√≥teles lo dijo", "Porque Google lo confunde"], "c": 0}, {"q": "(Footnote) ¬øQu√© broma hace sobre el costo de actuar √©ticamente?", "a": ["Que la √©tica es gratis‚Ä¶ salvo el precio del libro", "Que los buenos pagan m√°s impuestos", "Que se necesita una licencia", "Que cuesta perder amigos"], "c": 0}, {"q": "(Footnote) ¬øQu√© respondi√≥ Dr. Samuel Johnson cuando le corrigieron su error?", "a": ["‚ÄúIgnorancia, Madam. Pura ignorancia.‚Äù", "‚ÄúFui mal citado.‚Äù", "‚ÄúFue culpa del editor.‚Äù", "‚ÄúNo lo escrib√≠ yo.‚Äù"], "c": 0}, {"q": "(Footnote) ¬øA qui√©n culpa Schur de los errores filos√≥ficos del libro?", "a": ["Al profesor Todd May", "A su editor", "A su esposa", "A Arist√≥teles"], "c": 0}];
const MAX_WRONG_PER_QUESTION = 1; // a la 3¬™ falla: bloqueo
const LOCK_MINUTES = 30;

// ====== Estado ======
let current = 0;
let wrongThisQuestion = 0;
let lockedInterval = null;

// ====== Elementos ======
const intro = document.getElementById('intro');
const quiz = document.getElementById('quiz');
const finalScr = document.getElementById('final');
const lockScr = document.getElementById('lock');
const progress = document.getElementById('progress');
const qText = document.getElementById('qText');
const options = document.getElementById('options');
const feedback = document.getElementById('feedback');
const nextBtn = document.getElementById('nextBtn');
const retryBtn = document.getElementById('retryBtn');
const startBtn = document.getElementById('startBtn');
const checkAgain = document.getElementById('checkAgain');

// ====== Sonidos (WebAudio para evitar archivos) ======
let audioCtx;
function getCtx(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); return audioCtx; }

function playDing(){
  const ctx = getCtx();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = 'sine';
  o.frequency.setValueAtTime(880, ctx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1760, ctx.currentTime+0.15);
  g.gain.setValueAtTime(0.0001, ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime+0.25);
  o.connect(g).connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.3);
}

function playBuzzer(){
  const ctx = getCtx();
  const o1 = ctx.createOscillator();
  const o2 = ctx.createOscillator();
  const g = ctx.createGain();
  o1.type='square'; o2.type='square';
  o1.frequency.value = 220; o2.frequency.value = 180;
  g.gain.value = 0.2;
  o1.connect(g); o2.connect(g); g.connect(ctx.destination);
  o1.start(); o2.start();
  // vibrato "c√≥mico"
  const trem = ctx.createOscillator(); const tremGain = ctx.createGain();
  trem.frequency.value = 8; tremGain.gain.value = 80;
  trem.connect(tremGain);
  tremGain.connect(o1.frequency);
  tremGain.connect(o2.frequency);
  trem.start();
  setTimeout(()=>{ o1.stop(); o2.stop(); trem.stop(); }, 1200);
}

// ====== Bloqueo ======
function setLock(minutes){
  const until = Date.now() + minutes*60*1000;
  localStorage.setItem('quizLockUntil', String(until));
  showLock();
}

function showLock(){
  clearInterval(lockedInterval);
  intro.classList.remove('show');
  quiz.classList.remove('show');
  finalScr.classList.remove('show');
  lockScr.classList.add('show');
  const timer = document.getElementById('lockTimer');
  function tick(){
    const until = parseInt(localStorage.getItem('quizLockUntil')||'0',10);
    const left = until - Date.now();
    if(left <= 0){
      clearInterval(lockedInterval);
      localStorage.removeItem('quizLockUntil');
      // volver a intro
      lockScr.classList.remove('show');
      intro.classList.add('show');
      return;
    }
    const s = Math.floor(left/1000);
    const m = Math.floor(s/60);
    const ss = s%60;
    timer.textContent = String(m).padStart(2,'0')+":"+String(ss).padStart(2,'0');
  }
  tick();
  lockedInterval = setInterval(tick, 1000);
}

function checkLockOnLoad(){
  const until = parseInt(localStorage.getItem('quizLockUntil')||'0',10);
  if(until && until > Date.now()){
    showLock();
    return true;
  }
  return false;
}

// ====== Confeti minimal ======
const confettiCanvas = document.getElementById('confetti');
const cctx = confettiCanvas.getContext('2d');
let confettiPieces = [];
function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas); resizeCanvas();

function launchConfetti(){
  confettiPieces = [];
  for(let i=0;i<160;i++){
    confettiPieces.push({
      x: Math.random()*confettiCanvas.width,
      y: -10*Math.random()*confettiCanvas.height/2,
      size: 5+Math.random()*7,
      color: `hsl(${Math.random()*360},100%,60%)`,
      speed: 2+Math.random()*3,
      rot: Math.random()*Math.PI,
      rots: (Math.random()-.5)*0.2
    });
  }
  requestAnimationFrame(confettiLoop);
  setTimeout(()=> confettiPieces=[], 5000);
}
function confettiLoop(){
  cctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confettiPieces.forEach(p=>{
    cctx.save();
    cctx.translate(p.x, p.y);
    cctx.rotate(p.rot);
    cctx.fillStyle = p.color;
    cctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
    cctx.restore();
    p.y += p.speed;
    p.x += Math.sin(p.y*0.02)*1.2;
    p.rot += p.rots;
  });
  if(confettiPieces.length) requestAnimationFrame(confettiLoop);
}

// ====== Render ======
function setProgress(){
  progress.textContent = current < QUESTIONS.length ? `Pregunta ${current+1} de ${QUESTIONS.length}` : '';
}

function renderQuestion(){
  setProgress();
  const data = QUESTIONS[current];
  qText.textContent = data.q;
  feedback.textContent = '';
  feedback.className = 'feedback';
  options.innerHTML = '';
  nextBtn.disabled = true;
  wrongThisQuestion = 0;
  document.getElementById('retryBtn').classList.add('hidden');

  data.a.forEach((opt, idx)=>{
    const btn = document.createElement('button');
    btn.className = 'btn option';
    btn.textContent = opt;
    btn.addEventListener('click', ()=> handleAnswer(idx === data.c, btn));
    options.appendChild(btn);
  });
}

function handleAnswer(correct, el){
  if(correct){
    playDing();
    feedback.textContent = '‚úÖ ¬°Correcto!';
    feedback.className = 'feedback ok';
    nextBtn.disabled = false;
    document.querySelectorAll('.option').forEach(b=>{
      b.disabled = true;
      if(b === el){ b.classList.add('correct'); }
    });
  } else {
    wrongThisQuestion++;
    playBuzzer();
    feedback.textContent = '‚ùå Incorrecto. Intenta otra vez.';
    feedback.className = 'feedback no';
    el.classList.add('wrong');
    // bloqueo global si supera l√≠mite
    if(wrongThisQuestion > MAX_WRONG_PER_QUESTION){
      setLock(LOCK_MINUTES);
    }
  }
}

function nextQuestion(){
  current++;
  if(current >= QUESTIONS.length){
    // final
    quiz.classList.remove('show');
    finalScr.classList.add('show');
    launchConfetti();
    setProgress();
  }else{
    renderQuestion();
  }
}

// ====== Eventos ======
startBtn?.addEventListener('click', ()=>{
  if(checkLockOnLoad()) return;
  intro.classList.remove('show');
  quiz.classList.add('show');
  current = 0;
  renderQuestion();
});

nextBtn.addEventListener('click', nextQuestion);
checkAgain.addEventListener('click', ()=>{
  if(!checkLockOnLoad()){
    lockScr.classList.remove('show');
    intro.classList.add('show');
  }
});

// Autochequeo de bloqueo al cargar
if(!checkLockOnLoad()){
  // show intro por defecto
  intro.classList.add('show');
}
</script>
</body>
</html>
